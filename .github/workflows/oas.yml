name: Generate OAS Code for iOS, Android and Java Backend

on:
  push:
    branches: [ master ]

jobs:
  generate-oas-code:
    runs-on: macos-latest

    steps:
      # Checkout
      - uses: actions/checkout@v2
      - run: mkdir build

      # Brew
      - run: brew update
      - run: brew install openapi-generator xcodegen gradle || true
      - run: brew outdated openapi-generator || brew upgrade openapi-generator
      - run: brew outdated xcodegen || brew upgrade xcodegen
      - run: brew outdated gradle || brew upgrade gradle

      # iOS
      - run: echo '{"projectName":"MGMRemoteApiClient"}' > build/ios-oas-config.json
      - run: openapi-generator generate -i 'v1/openapi.yaml' -g swift4 -c build/ios-oas-config.json -o .
      - run: rm -rf MGMRemoteApiClient.xcodeproj
      - run: xcodegen

      # Android
      - run: echo '{"groupId":"uk.co.cerihughes.mgm","artifactId":"remoteapi","artifactVersion":"1.0.0","packageName":"uk.co.cerihughes.mgm.android.remoteapi"}' > build/android-oas-config.json
      - run: openapi-generator generate -i 'v1/openapi.yaml' -g kotlin -c build/android-oas-config.json -o build/Android
      - run: cd build/Android; gradle assemble
